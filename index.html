<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />

    <title>Mercadinho</title>

    <!-- Required Stylesheets -->
    <link
      type="text/css"
      rel="stylesheet"
      href="https://unpkg.com/bootstrap/dist/css/bootstrap.min.css"
    />
    <link
      type="text/css"
      rel="stylesheet"
      href="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.css"
    />

    <!-- Load polyfills to support older browsers -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es2015%2CIntersectionObserver"></script>

    <!-- Required scripts -->
    <script src="https://unpkg.com/vue@latest/dist/vue.js"></script>
    <script src="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://underscorejs.org/underscore-min.js"></script>

  </head>
  <body>
    <!-- Our application root element -->
    <div id="app">
      <b-container>
        <b-jumbotron header="Mercadinho" lead="Monte seu pedido">          
        </b-jumbotron>

        <div>
            <b-form>
                <b-card header="Pesquisa do produto">
                    
                    
                    <label for="input-with-list">Produto</label>
                    <b-form-select  id="input-list" :options="tiposProduto" v-model="form.tipoSelecionado"></b-form-select >
                    
                    <label for="input-with-list">Selecione a opção desejada</label>
                    <b-form-select  v-model="form.produtoSelecionado" :options="listaProdutos" :select-size="5"></b-form-select>
                                        
                    <b-form-row>    
                        <b-col>
                            <label for="preco">Preço R$</label>
                            <b-form-input id="preco" :disabled="true" v-model='form.produtoSelecionado.preço' disable></b-form-input>
                        </b-col>
                        <b-col>
                            <label for="quantidade-sb">Quantiade</label>
                            <b-form-spinbutton id="quantidade-sb" class="mb-2" v-model="form.quantidade" min="1" max="100"></b-form-spinbutton>
                        </b-col>
                        <b-col>
                            <label for="totalitem">Total do item R$</label>
                            <b-form-input id="totalitem" :disabled="true" v-model='totalItem' disable></b-form-input>
                        </b-col>
                    </b-form-row>
                    <b-button variant="primary">Adicionar Item</b-button>
                </b-card>                
                <b-card bg-variant="light">
                    <b-form-group label-cols-lg="3" label="Endereço" label-size="lg" label-class="font-weight-bold pt-0" class="mb-0" >
                      <b-form-group label-cols-sm="3" label="Rua:" label-align-sm="right" label-for="nested-street" >
                        <b-form-input id="nested-street"></b-form-input>
                      </b-form-group>
                
                      <b-form-group label-cols-sm="3" label="Número:" label-align-sm="right" label-for="nested-city" >
                        <b-form-input id="nested-city"></b-form-input>
                      </b-form-group>
                                      
                      <b-form-group label-cols-sm="3" label="Forma de Pagamento:" label-align-sm="right" class="mb-0">
                        <b-form-radio-group class="pt-2" :options="['Cartão', 'Dinheiro', 'Transferência']" ></b-form-radio-group>
                      </b-form-group>

                    </b-form-group>
                  </b-card>
            </b-form>
            <b-card class="mt-3" header="Form Data Result">
              <pre class="m-0">{{ form }}</pre>
            </b-card>
          </div>
          
      </b-container>
    </div>

    <!-- Start running your app -->
    <script>
      window.app = new Vue({
        el: '#app',
        data : {
            form : {
                tipoSelecionado:'',
                produtoSelecionado:'',
                quantidade:1
            },
            planilha: null,
        },
        computed: {
          showAlert() {
            return this.name.length > 4 ? true : false
          },
          tiposProduto() {
              return _.uniq(_.map(this.planilha, (item) => item.produto));
          },
          listaProdutos() {
              return _.map(_.where(this.planilha, { produto : this.form.tipoSelecionado }), 
                function(x) { return { text: x.descrição, value: x}; });
          },
          totalItem(){
              console.log(this.form.produtoSelecionado.preço);
              var preco = this.form.produtoSelecionado ? this.form.produtoSelecionado.preço.replace(',', '.') : 0;
              return (preco * this.form.quantidade).toLocaleString('pt-br', {minimumFractionDigits: 2});
          }
        },
        mounted () {
            axios
            .get('http://gsx2json.com/api?id=1Hnksz9ikcghO4DtSrTq_QeAIqsLPKqpI0DQC8CxYO7o&sheet=1&columns=false')
            .then(response => {
                this.planilha = response.data.rows;
                for (let i = 0; i < this.planilha.length; i++) {
                    const item = this.planilha[i];
                    console.log(item.preço);
                    item.preço = parseFloat(item.preço.replace(',', '.')).toLocaleString('pt-br', {minimumFractionDigits: 2});
                }
            });
        }
      })
    </script>
  </body>
</html>
